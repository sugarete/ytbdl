{%extends "index.html"%}
{%block content%}
<img class="img-title" src="../static/images/title.png" alt="logo" style="width: auto; height: 175px" />
<form id="download-form" class="main-page1" method="GET" onkeydown="return event.key != 'Enter'">
    <button class="paste">
        <img src="../static/images/paste.png" alt="link" />
    </button>
    <input type="text" autocomplete="off" name="url" id="url" placeholder="Search or Paste YT's URL here" />
    <button class="reset" type="reset" onclick="reset()" style="background-color: black">
        <img src="../static/images/clear.png" />
    </button>


    <button class="search" type="search" style="background-color: black" onclick="setManualAction('/search', this)"
        value="Click for popup">
        <img src="../static/images/search.png" />
    </button>

    <button class="proceed">
        <img src="../static/images/proceed.png" alt="proceed" />
    </button>
</form>

<div id="myModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        {% if videos %}
        <h2 style="margin-bottom: 10px; margin-left: 5px">Search Results:</h2>
        <div class="videos-container">
            {% for video in videos[0:5] %}
            <div class="video-item" onclick="redirectToHome('{{ video.url }}')">
                <img syle="object-fit: contain; width: 100%; height: 100%;"class="thumbnail" src="{{ video.thumbnail }}" alt="{{ video.title }}">
                <a href="/home?url={{ video.url }}">{{ video.title }}</a>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</div>

<div class="UserPage" id="UserPage" style="display: none">
    <div class="UserPage-content">
        <span class="close" onclick="document.getElementById('UserPage').style.display = 'none';">&times;</span>
        <div class="Userpage-header">
            <h2 style="margin-bottom: 10px">User Page</h2>
        </div>
        {% if username == None %}
        <div class="login-page" style="display: none;">
            <form class="login-form" action="/auth/login" method="POST">
                <input type="text" name="username" placeholder="username" />
                <input type="password" name="password" placeholder="password" />
                <button type="submit">login</button>
                <button type="button" onclick="document.getElementById('log-btn').style.display = 'block'; document.getElementsByClassName('login-page')[0].style.display = 'none';">cancel</button>
            </form> 
        </div>
        <div class="register-page" style="display: none;">
            <form class="register-form" action="/auth/register" method="POST">
                <input type="text" name="username" placeholder="username" />
                <input type="password" name="password" placeholder="password" />
                <input type="password" name="confirm_password" placeholder="confirm password" />
                <button type="submit">register</button>
                <button type="button" onclick="document.getElementById('log-btn').style.display = 'block'; document.getElementsByClassName('register-page')[0].style.display = 'none';">cancel</button>
            </form>
        </div>
        <div class="login-register" id="log-btn">
            <button onclick="document.getElementById('log-btn').style.display = 'none'; document.getElementsByClassName('login-page')[0].style.display = 'block';">login</button>
            <button onclick="document.getElementById('log-btn').style.display = 'none'; document.getElementsByClassName('register-page')[0].style.display = 'block';">register</button>
        </div>
        {% else %}
        <div class="user-info">
            <h3>Username: {{ username }}</h3>
            {%for row in history%}
            <h3>Downloaded: {{ row }}</h3>
            {%endfor%}
            <a href="/auth/logout">logout</a>
        </div>
        {% endif %}
    </div>
</div>

<div class="option">
    <button type="button" style="margin-right: 20px; border-radius: 10px" onclick="OpenUserPage()"> 
        <img src="../static/images/user.png" alt="user" />
    </button>
    <button id="video-button" onclick="setManualAction('/dl/video', this)">
        <img style="height: 40px; width: auto; margin-right: 2px; margin-left: 10px" src="../static/images/demon1.png" alt="video" />
        video
    </button>
    <button id="advanced-button" onclick="setManualAction('/extract', this)">
        advanced
    </button>
    <button id="audio-button" onclick="setManualAction('/dl/audio', this)">
        audio
        <img style="height: 43px; width: auto; margin-left: 2px" src="../static/images/demon2.png" alt="audio" />
    </button>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        var urlParams = new URLSearchParams(window.location.search);
        var urlValue = urlParams.get('url');
        if (urlValue) {
            document.getElementById('url').value = decodeURIComponent(urlValue);
        }
        var showResults = Boolean("{{show_results}}") || false; // Ensure it's a lowercase boolean
        if (showResults) {
            openModal();
        }
        // Set "video-button" as the default selected button
        var defaultOption = document.getElementById("video-button");
        if (defaultOption) {
            setManualAction('/dl/video', defaultOption);
        }
    });

    function reset() {
        document.getElementById('url').value = '';
    }

    function setManualAction(action, button) {
        // Remove the "selected" class from all buttons
        var buttons = document.querySelectorAll('.option button');
        buttons.forEach(function (btn) {
            btn.classList.remove('selected');
        });

        // Set the "selected" class for the clicked button
        button.classList.add("selected");

        // Set the action for the form
        document.getElementById("download-form").action = action;
    }

    function redirectToHome(url) {
        window.location.href = '/home?url=' + encodeURIComponent(url);
    }

    function openModal() {
        document.getElementById('myModal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('myModal').style.display = 'none';
    }

    function OpenUserPage() {
        var x = document.getElementById("UserPage");
        if (x.style.display === "none") {
            x.style.display = "block";
        } else {
            x.style.display = "none";
        }
    }
</script>
{% endblock %}